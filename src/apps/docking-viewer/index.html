<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <title>Mol* Docking Viewer</title>
        <style>
            #app {
                position: absolute;
                left: 100px;
                top: 100px;
                width: 800px;
                height: 600px;
            }
        </style>
        <link rel="stylesheet" type="text/css" href="molstar.css" />
    </head>
    <body>
        <div id="app"></div>
        <script type="text/javascript" src="./molstar.js"></script>
        <script type="text/javascript">
            function getParam(name, regex) {
                var r = new RegExp(name + '=' + '(' + regex + ')[&]?', 'i');
                return decodeURIComponent(((window.location.search || '').match(r) || [])[1] || '');
            }
            var pdbqt = getParam('pdbqt', '[^&]+').trim() || '../../examples/ace2.pdbqt';
            var mol2 = getParam('mol2', '[^&]+').trim() || '../../examples/ace2-hit.mol2';
            
            // GPU backend preference: 'webgl' (default), 'webgpu', or 'auto'
            var backend = getParam('backend', '[^&]+').trim() || 'webgl';
            
            // Validate backend parameter
            if (backend !== 'webgl' && backend !== 'webgpu' && backend !== 'auto') {
                console.warn('Invalid backend "' + backend + '", using "webgl". Valid options: webgl, webgpu, auto');
                backend = 'webgl';
            }

            DockingViewer.create('app', [0x33DD22, 0x1133EE], true, backend).then(viewer => {
                viewer.loadStructuresFromUrlsAndMerge([
                    { url: pdbqt, format: 'pdbqt' },
                    { url: mol2, format: 'mol2' }
                ]);
            }).catch(error => {
                console.error('Failed to initialize DockingViewer:', error);
                document.getElementById('app').innerHTML = 
                    '<div style="padding: 20px; color: red;">' +
                    '<h3>Error initializing viewer</h3>' +
                    '<p>' + (error.message || 'Unknown error') + '</p>' +
                    '<p>If using WebGPU, please ensure your browser supports it (Chrome 113+, Edge 113+, or Firefox with webgpu enabled).</p>' +
                    '</div>';
            });
        </script>
    </body>
</html>
